<!-- apps/accounts/templates/accounts/groups/edit_group.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Edit {{ group.name }} - MyRecoveryPal{% endblock %}

{% block extra_css %}
<style>
    .form-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }

    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e0e0e0;
    }

    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .section-title {
        color: #1e4d8b;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-control {
        border-radius: 10px;
        border: 2px solid #e0e0e0;
        padding: 0.75rem 1rem;
        transition: border-color 0.3s;
    }

    .form-control:focus {
        border-color: #52b788;
        box-shadow: 0 0 0 0.2rem rgba(82, 183, 136, 0.25);
    }

    .form-select {
        border-radius: 10px;
        border: 2px solid #e0e0e0;
        padding: 0.75rem 1rem;
    }

    .help-text {
        font-size: 0.875rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }

    .color-picker {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        border: 2px solid #e0e0e0;
        cursor: pointer;
    }

    .btn-primary {
        background: #52b788;
        border-color: #52b788;
        border-radius: 10px;
        padding: 0.75rem 2rem;
        font-weight: 600;
    }

    .btn-outline-secondary {
        border-radius: 10px;
        padding: 0.75rem 2rem;
    }

    .btn-outline-danger {
        border-radius: 10px;
        padding: 0.75rem 2rem;
    }

    .danger-zone {
        background: #fff5f5;
        border: 1px solid #f8d7da;
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <h1>Edit Group Settings</h1>
                <p class="lead">{{ group.name }}</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{% url 'accounts:group_detail' pk=group.id %}" class="btn btn-light">
                    <i class="fas fa-arrow-left"></i> Back to Group
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="form-card">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h4 class="section-title">
                            <i class="fas fa-edit"></i> Basic Information
                        </h4>

                        <div class="mb-3">
                            <label for="name" class="form-label">Group Name *</label>
                            <input type="text" class="form-control" id="name" name="name"
                                value="{{ group.name }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="4"
                                required>{{ group.description }}</textarea>
                        </div>
                    </div>

                    <!-- Group Settings -->
                    <div class="form-section">
                        <h4 class="section-title">
                            <i class="fas fa-cog"></i> Group Settings
                        </h4>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="group_type" class="form-label">Group Type *</label>
                                    <select class="form-select" id="group_type" name="group_type" required>
                                        {% for value, label in group_types %}
                                        <option value="{{ value }}" {% if group.group_type == value %}selected{% endif %}>{{ label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="privacy_level" class="form-label">Privacy Level *</label>
                                    <select class="form-select" id="privacy_level" name="privacy_level" required>
                                        <option value="public" {% if group.privacy_level == 'public' %}selected{% endif %}>Public - Anyone can join</option>
                                        <option value="private" {% if group.privacy_level == 'private' %}selected{% endif %}>Private - Approval required</option>
                                        <option value="secret" {% if group.privacy_level == 'secret' %}selected{% endif %}>Secret - Invitation only</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="location" class="form-label">Location (Optional)</label>
                                    <input type="text" class="form-control" id="location" name="location"
                                        value="{{ group.location }}" placeholder="City, State or 'Online'">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="max_members" class="form-label">Max Members (Optional)</label>
                                    <input type="number" class="form-control" id="max_members" name="max_members"
                                        value="{{ group.max_members|default:'' }}" placeholder="Leave blank for unlimited">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="meeting_schedule" class="form-label">Meeting Schedule (Optional)</label>
                            <input type="text" class="form-control" id="meeting_schedule" name="meeting_schedule"
                                value="{{ group.meeting_schedule }}" placeholder="e.g., 'Mondays 7 PM EST'">
                        </div>
                    </div>

                    <!-- Appearance -->
                    <div class="form-section">
                        <h4 class="section-title">
                            <i class="fas fa-palette"></i> Appearance
                        </h4>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="group_image" class="form-label">Group Image</label>
                                    {% if group.group_image %}
                                    <div class="mb-2">
                                        <img src="{{ group.group_image.url }}" alt="Current image" style="max-width: 100px; border-radius: 8px;">
                                        <small class="text-muted d-block">Current image</small>
                                    </div>
                                    {% endif %}
                                    <input type="file" class="form-control" id="group_image" name="group_image"
                                        accept="image/*">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="group_color" class="form-label">Group Color</label>
                                    <div class="d-flex align-items-center gap-3">
                                        <input type="color" class="color-picker" id="group_color" name="group_color"
                                            value="{{ group.group_color|default:'#52b788' }}">
                                        <span class="help-text">Choose a color theme for your group</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-flex gap-3 justify-content-end">
                        <a href="{% url 'accounts:group_detail' pk=group.id %}" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </form>

            <!-- Danger Zone -->
            <div class="danger-zone">
                <h5 class="text-danger"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h5>
                <p class="text-muted mb-3">These actions cannot be undone. Please proceed with caution.</p>
                <button class="btn btn-outline-danger" disabled>
                    <i class="fas fa-archive"></i> Archive Group (Coming Soon)
                </button>
            </div>
        </div>

        <!-- Stats Sidebar -->
        <div class="col-md-4">
            <div class="form-card">
                <h5><i class="fas fa-chart-bar"></i> Group Statistics</h5>
                <div class="mt-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Members:</span>
                        <strong>{{ group.member_count }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Posts:</span>
                        <strong>{{ group.posts.count }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Created:</span>
                        <strong>{{ group.created_at|date:"M d, Y" }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Privacy:</span>
                        <strong>{{ group.get_privacy_level_display }}</strong>
                    </div>
                </div>
            </div>

            <div class="form-card">
                <h5><i class="fas fa-info-circle"></i> Tips</h5>
                <ul class="small text-muted ps-3">
                    <li class="mb-2">Changing privacy from public to private won't affect existing members</li>
                    <li class="mb-2">Max members limit only applies to new join requests</li>
                    <li class="mb-2">Group type helps users find your group in searches</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
