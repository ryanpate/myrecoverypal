<!-- apps/accounts/templates/accounts/enhanced_dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - MyRecoveryPal{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, #1e4d8b 0%, #52b788 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .main-feed {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .feed-header {
        padding: 1.5rem;
        border-bottom: 1px solid #f0f0f0;
        background: #f8f9fa;
    }

    .activity-feed {
        max-height: 800px;
        overflow-y: auto;
    }

    .activity-item {
        padding: 1.5rem;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.3s;
    }

    .activity-item:hover {
        background: #f8f9fa;
    }

    .activity-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .activity-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .activity-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .activity-content {
        flex: 1;
    }

    .activity-user {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.25rem;
    }

    .activity-time {
        font-size: 0.85rem;
        color: #666;
    }

    .activity-description {
        margin: 1rem 0;
        line-height: 1.5;
    }

    .activity-engagement {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #f0f0f0;
    }

    .engagement-btn {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .engagement-btn:hover {
        background: #f0f0f0;
        color: #52b788;
    }

    .engagement-btn.liked {
        color: #e74c3c;
        background: #fee;
    }

    .sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .sidebar-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    }

    .sidebar-section h3 {
        margin-bottom: 1rem;
        color: #333;
        font-size: 1.1rem;
    }

    .quick-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    .stat-item {
        text-align: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
        color: #52b788;
        margin-bottom: 0.25rem;
    }

    .stat-label {
        font-size: 0.85rem;
        color: #666;
    }

    .connection-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        border-radius: 8px;
        transition: background 0.3s;
    }

    .connection-item:hover {
        background: #f8f9fa;
    }

    .connection-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        flex-shrink: 0;
    }

    .connection-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .connection-info {
        flex: 1;
        min-width: 0;
    }

    .connection-name {
        font-weight: 500;
        color: #333;
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .connection-status {
        font-size: 0.8rem;
        color: #666;
    }

    .group-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        border-radius: 8px;
        transition: background 0.3s;
        text-decoration: none;
        color: inherit;
    }

    .group-item:hover {
        background: #f8f9fa;
        text-decoration: none;
        color: inherit;
    }

    .group-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: #52b788;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .checkin-form {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 1rem;
    }

    .mood-selector {
        display: flex;
        gap: 0.5rem;
        margin: 1rem 0;
        flex-wrap: wrap;
    }

    .mood-option {
        padding: 0.5rem 1rem;
        border: 2px solid #ddd;
        border-radius: 25px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
    }

    .mood-option:hover {
        border-color: #52b788;
    }

    .mood-option.selected {
        background: #52b788;
        color: white;
        border-color: #52b788;
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: white;
        color: #666;
        text-decoration: none;
        transition: all 0.3s;
        font-size: 0.9rem;
        justify-content: center;
    }

    .action-btn:hover {
        background: #f8f9fa;
        color: #52b788;
        border-color: #52b788;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .milestone-item {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        border-left: 4px solid #52b788;
    }

    .milestone-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 0.25rem;
    }

    .milestone-date {
        font-size: 0.85rem;
        color: #666;
    }

    .suggested-connection {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 0.75rem;
    }

    .suggestion-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .suggestion-info {
        flex: 1;
        min-width: 0;
    }

    .suggestion-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .suggestion-reason {
        font-size: 0.8rem;
        color: #666;
    }

    .follow-suggestion-btn {
        background: #52b788;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s;
    }

    .follow-suggestion-btn:hover {
        background: #45a374;
        transform: translateY(-1px);
    }

    .empty-feed {
        text-align: center;
        padding: 3rem 2rem;
        color: #666;
    }

    .empty-feed-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    @media (max-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
        
        .sidebar {
            order: -1;
        }
    }

    @media (max-width: 768px) {
        .quick-stats {
            grid-template-columns: 1fr;
        }
        
        .quick-actions {
            grid-template-columns: 1fr;
        }
        
        .mood-selector {
            justify-content: center;
        }
        
        .activity-header {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1>Welcome back, {{ user.get_full_name|default:user.username }}! üëã</h1>
                <p class="lead">
                    {% if user.get_days_sober > 0 %}
                        üåü {{ user.get_days_sober }} days strong in your recovery journey
                    {% else %}
                        Your recovery journey starts here
                    {% endif %}
                </p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{% url 'accounts:daily_checkin' %}" class="btn btn-light btn-lg">
                    ‚úÖ Daily Check-in
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="dashboard-grid">
        <!-- Main Activity Feed -->
        <div class="main-feed">
            <div class="feed-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3>üåä Community Activity</h3>
                    <div class="d-flex gap-2">
                        <a href="{% url 'accounts:community' %}" class="btn btn-outline-primary btn-sm">
                            üë• Browse Community
                        </a>
                        <a href="{% url 'blog:post_create' %}" class="btn btn-primary btn-sm">
                            ‚úçÔ∏è Share Story
                        </a>
                    </div>
                </div>
            </div>

            <!-- Daily Check-in Form -->
            <div class="checkin-form">
                <h4>How are you feeling today?</h4>
                <form method="post" action="{% url 'accounts:daily_checkin' %}">
                    {% csrf_token %}
                    <div class="mood-selector">
                        <label class="mood-option">
                            <input type="radio" name="mood" value="great" style="display: none;">
                            üòä Great
                        </label>
                        <label class="mood-option">
                            <input type="radio" name="mood" value="good" style="display: none;">
                            üôÇ Good
                        </label>
                        <label class="mood-option">
                            <input type="radio" name="mood" value="okay" style="display: none;">
                            üòê Okay
                        </label>
                        <label class="mood-option">
                            <input type="radio" name="mood" value="struggling" style="display: none;">
                            üòî Struggling
                        </label>
                        <label class="mood-option">
                            <input type="radio" name="mood" value="difficult" style="display: none;">
                            üò∞ Difficult
                        </label>
                    </div>
                    <textarea name="gratitude" placeholder="What are you grateful for today?" class="form-control mb-2" rows="2"></textarea>
                    <textarea name="challenge" placeholder="What's your biggest challenge today?" class="form-control mb-2" rows="2"></textarea>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">Share Check-in</button>
                        <label class="form-check-label">
                            <input type="checkbox" name="is_shared" class="form-check-input">
                            Share with community
                        </label>
                    </div>
                </form>
            </div>

            <!-- Activity Feed -->
            <div class="activity-feed">
                {% for activity in recent_activities %}
                <div class="activity-item">
                    <div class="activity-header">
                        <div class="activity-avatar">
                            {% if activity.user.profile.avatar %}
                                <img src="{{ activity.user.profile.avatar.url }}" alt="{{ activity.user.username }}">
                            {% else %}
                                üë§
                            {% endif %}
                        </div>
                        <div class="activity-content">
                            <div class="activity-user">
                                <a href="{% url 'accounts:profile' activity.user.username %}" style="text-decoration: none; color: inherit;">
                                    {{ activity.user.get_full_name|default:activity.user.username }}
                                </a>
                            </div>
                            <div class="activity-time">{{ activity.created_at|timesince }} ago</div>
                        </div>
                        {% if activity.activity_type == 'milestone_created' %}
                            <div style="background: #fff3cd; padding: 0.5rem; border-radius: 50%; color: #856404;">
                                üèÜ
                            </div>
                        {% elif activity.activity_type == 'blog_post_published' %}
                            <div style="background: #d1ecf1; padding: 0.5rem; border-radius: 50%; color: #0c5460;">
                                üìù
                            </div>
                        {% elif activity.activity_type == 'check_in_posted' %}
                            <div style="background: #d4edda; padding: 0.5rem; border-radius: 50%; color: #155724;">
                                ‚úÖ
                            </div>
                        {% endif %}
                    </div>

                    <div class="activity-description">
                        <strong>{{ activity.title }}</strong>
                        {% if activity.description %}
                            <p style="margin: 0.5rem 0 0 0; color: #666;">{{ activity.description }}</p>
                        {% endif %}
                    </div>

                    <div class="activity-engagement">
                        <button class="engagement-btn" onclick="likeActivity({{ activity.id }})">
                            ‚ù§Ô∏è {{ activity.likes_count }} Like{{ activity.likes_count|pluralize }}
                        </button>
                        <button class="engagement-btn" onclick="toggleComments({{ activity.id }})">
                            üí¨ {{ activity.comments.count }} Comment{{ activity.comments.count|pluralize }}
                        </button>
                        <button class="engagement-btn">
                            üîó Share
                        </button>
                    </div>

                    <!-- Comments Section -->
                    <div id="comments-{{ activity.id }}" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #f0f0f0;">
                        {% for comment in activity.comments.all|slice:":3" %}
                        <div style="margin-bottom: 0.75rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                            <strong>{{ comment.user.get_full_name|default:comment.user.username }}</strong>
                            <span style="color: #666; font-size: 0.85rem;">{{ comment.created_at|timesince }} ago</span>
                            <p style="margin: 0.25rem 0 0 0;">{{ comment.content }}</p>
                        </div>
                        {% endfor %}
                        
                        <form onsubmit="submitComment(event, {{ activity.id }})" style="margin-top: 1rem;">
                            <div class="d-flex gap-2">
                                <input type="text" placeholder="Write a supportive comment..." class="form-control" required>
                                <button type="submit" class="btn btn-primary btn-sm">Post</button>
                            </div>
                        </form>
                    </div>
                </div>
                {% empty %}
                <div class="empty-feed">
                    <div class="empty-feed-icon">üå±</div>
                    <h4>Your community feed is growing!</h4>
                    <p>Follow other members to see their recovery updates and milestones here.</p>
                    <a href="{% url 'accounts:community' %}" class="btn btn-primary">Discover Community</a>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Quick Stats -->
            <div class="sidebar-section">
                <h3>üìä Your Progress</h3>
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ user.get_days_sober }}</div>
                        <div class="stat-label">Days Sober</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user.followers_count }}</div>
                        <div class="stat-label">Followers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user.following_count }}</div>
                        <div class="stat-label">Following</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user.get_joined_groups.count }}</div>
                        <div class="stat-label">Groups</div>
                    </div>
                </div>
            </div>

            <!-- Recovery Connections -->
            <div class="sidebar-section">
                <h3>ü§ù Your Network</h3>
                
                {% if user.get_active_sponsor %}
                <div class="connection-item">
                    <div class="connection-avatar">
                        {% if user.get_active_sponsor.profile.avatar %}
                            <img src="{{ user.get_active_sponsor.profile.avatar.url }}" alt="Sponsor">
                        {% else %}
                            üéØ
                        {% endif %}
                    </div>
                    <div class="connection-info">
                        <div class="connection-name">{{ user.get_active_sponsor.get_full_name|default:user.get_active_sponsor.username }}</div>
                        <div class="connection-status">Your Sponsor</div>
                    </div>
                </div>
                {% endif %}

                {% if user.get_recovery_pal %}
                <div class="connection-item">
                    <div class="connection-avatar">
                        {% if user.get_recovery_pal.profile.avatar %}
                            <img src="{{ user.get_recovery_pal.profile.avatar.url }}" alt="Pal">
                        {% else %}
                            ü§ù
                        {% endif %}
                    </div>
                    <div class="connection-info">
                        <div class="connection-name">{{ user.get_recovery_pal.get_full_name|default:user.get_recovery_pal.username }}</div>
                        <div class="connection-status">Recovery Pal</div>
                    </div>
                </div>
                {% endif %}

                {% if user.get_active_sponsorships %}
                <h5 style="margin: 1rem 0 0.5rem 0; font-size: 0.9rem; color: #666;">Your Sponsees</h5>
                {% for sponsorship in user.get_active_sponsorships|slice:":3" %}
                <div class="connection-item">
                    <div class="connection-avatar">
                        {% if sponsorship.sponsee.profile.avatar %}
                            <img src="{{ sponsorship.sponsee.profile.avatar.url }}" alt="Sponsee">
                        {% else %}
                            üë§
                        {% endif %}
                    </div>
                    <div class="connection-info">
                        <div class="connection-name">{{ sponsorship.sponsee.get_full_name|default:sponsorship.sponsee.username }}</div>
                        <div class="connection-status">Sponsee</div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}

                <div class="quick-actions">
                    <a href="{% url 'accounts:sponsor_dashboard' %}" class="action-btn">
                        üéØ Sponsors
                    </a>
                    <a href="{% url 'accounts:pal_dashboard' %}" class="action-btn">
                        ü§ù Pals
                    </a>
                    <a href="{% url 'accounts:following_list' user.username %}" class="action-btn">
                        üë• Following
                    </a>
                    <a href="{% url 'accounts:followers_list' user.username %}" class="action-btn">
                        üë• Followers
                    </a>
                </div>
            </div>

            <!-- Suggested Connections -->
            {% if suggested_users %}
            <div class="sidebar-section">
                <h3>üí° Suggested for You</h3>
                {% for suggested_user in suggested_users|slice:":2" %}
                <div class="suggested-connection">
                    <div class="suggestion-avatar">
                        {% if suggested_user.profile.avatar %}
                            <img src="{{ suggested_user.profile.avatar.url }}" alt="{{ suggested_user.username }}">
                        {% else %}
                            üë§
                        {% endif %}
                    </div>
                    <div class="suggestion-info">
                        <div class="suggestion-name">{{ suggested_user.get_full_name|default:suggested_user.username }}</div>
                        <div class="suggestion-reason">Similar interests</div>
                    </div>
                    <button class="follow-suggestion-btn" onclick="followUser('{{ suggested_user.username }}')">
                        Follow
                    </button>
                </div>
                {% endfor %}
                <a href="{% url 'accounts:suggested_users' %}" class="btn btn-outline-primary btn-sm w-100">
                    See More Suggestions
                </a>
            </div>
            {% endif %}

            <!-- Recent Milestones -->
            <div class="sidebar-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>üèÜ Recent Milestones</h3>
                    <a href="{% url 'accounts:add_milestone' %}" class="btn btn-outline-success btn-sm">Add</a>
                </div>
                {% for milestone in recent_milestones|slice:":3" %}
                <div class="milestone-item">
                    <div class="milestone-title">{{ milestone.title }}</div>
                    <div class="milestone-date">{{ milestone.date_achieved|date:"M j, Y" }}</div>
                </div>
                {% empty %}
                <p class="text-muted">No milestones yet. <a href="{% url 'accounts:add_milestone' %}">Add your first one!</a></p>
                {% endfor %}
            </div>

            <!-- My Groups -->
            {% if user.get_joined_groups %}
            <div class="sidebar-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>üë• My Groups</h3>
                    <a href="{% url 'accounts:my_groups' %}" class="btn btn-outline-primary btn-sm">All</a>
                </div>
                {% for group in user.get_joined_groups|slice:":3" %}
                <a href="{% url 'accounts:group_detail' group.id %}" class="group-item">
                    <div class="group-icon" style="background: {{ group.group_color }};">
                        {% if group.group_type == 'addiction_type' %}üéØ
                        {% elif group.group_type == 'location' %}üìç
                        {% elif group.group_type == 'recovery_stage' %}‚≠ê
                        {% else %}üë•
                        {% endif %}
                    </div>
                    <div class="flex-grow-1">
                        <div style="font-weight: 500;">{{ group.name }}</div>
                        <div style="font-size: 0.8rem; color: #666;">{{ group.member_count }} members</div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Quick Actions -->
            <div class="sidebar-section">
                <h3>‚ö° Quick Actions</h3>
                <div class="quick-actions" style="grid-template-columns: 1fr;">
                    <a href="{% url 'accounts:edit_profile' %}" class="action-btn">
                        ‚úèÔ∏è Edit Profile
                    </a>
                    <a href="{% url 'accounts:messages' %}" class="action-btn">
                        üì¨ Messages
                        {% if unread_messages > 0 %}
                        <span style="background: red; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">{{ unread_messages }}</span>
                        {% endif %}
                    </a>
                    <a href="{% url 'journal:dashboard' %}" class="action-btn">
                        üìì Journal
                    </a>
                    <a href="{% url 'blog:post_list' %}" class="action-btn">
                        üìñ Read Blog
                    </a>
                    <a href="{% url 'resources:list' %}" class="action-btn">
                        üìö Resources
                    </a>
                    <a href="{% url 'accounts:groups_list' %}" class="action-btn">
                        üèóÔ∏è Create Group
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Mood selector functionality
document.querySelectorAll('.mood-option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
        this.classList.add('selected');
        this.querySelector('input').checked = true;
    });
});

// Activity interactions
async function likeActivity(activityId) {
    try {
        const response = await fetch(`/accounts/like-activity/${activityId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        });
        
        const data = await response.json();
        if (data.success) {
            // Update like count and button state
            location.reload(); // Simple reload for now
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

function toggleComments(activityId) {
    const commentsDiv = document.getElementById(`comments-${activityId}`);
    commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
}

async function submitComment(event, activityId) {
    event.preventDefault();
    const form = event.target;
    const input = form.querySelector('input');
    
    try {
        const response = await fetch(`/accounts/comment-on-activity/${activityId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `comment=${encodeURIComponent(input.value)}`
        });
        
        const data = await response.json();
        if (data.success) {
            input.value = '';
            location.reload(); // Simple reload for now
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

async function followUser(username) {
    try {
        const response = await fetch(`/accounts/follow/${username}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        });
        
        const data = await response.json();
        if (data.success) {
            showToast(data.is_following ? 'Now following!' : 'Unfollowed', 'success');
            setTimeout(() => location.reload(), 1000);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible`;
    toast.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 3000);
}

// Add CSRF token if not present
document.addEventListener('DOMContentLoaded', function() {
    if (!document.querySelector('[name=csrfmiddlewaretoken]')) {
        const token = document.createElement('input');
        token.type = 'hidden';
        token.name = 'csrfmiddlewaretoken';
        token.value = '{{ csrf_token }}';
        document.body.appendChild(token);
    }
});
</script>
{% endblock %}