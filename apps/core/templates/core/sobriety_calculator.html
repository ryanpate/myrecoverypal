{% extends 'base.html' %}
{% load static %}

{% block title %}Free Sobriety Calculator - Track Your Clean Time | MyRecoveryPal{% endblock %}
{% block meta_description %}Free sobriety calculator. See days, weeks, months sober plus milestones, money saved & health benefits. No signup required.{% endblock %}
{% block meta_keywords %}sobriety calculator, how long have i been sober, sober calculator, clean time calculator, sobriety date calculator, days sober calculator, sobriety clock, sober time calculator{% endblock %}

{% block canonical_url %}https://www.myrecoverypal.com/sobriety-calculator/{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Free Sobriety Calculator",
  "description": "Calculate how long you've been sober with our free sobriety calculator. Shows days, weeks, months, years plus milestones reached and health benefits.",
  "url": "https://www.myrecoverypal.com/sobriety-calculator/",
  "applicationCategory": "HealthApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Calculate days sober",
    "Track weeks and months",
    "Milestone celebrations",
    "Money saved calculator",
    "Health benefits timeline"
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How do I calculate my sobriety date?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Enter the last day you drank alcohol or used drugs into the calculator above. The tool automatically calculates your total sober time in days, weeks, months, and years."
      }
    },
    {
      "@type": "Question",
      "name": "What counts as a sobriety date?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Your sobriety date is typically the day after your last drink or drug use. For example, if you had your last drink on January 1st, your sobriety date would be January 2nd."
      }
    },
    {
      "@type": "Question",
      "name": "How much money can I save by not drinking?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "The average person who drinks regularly spends $50-150 per week on alcohol. Over a year, that's $2,600-$7,800 saved. Our calculator lets you enter your personal spending to see exactly how much you've saved."
      }
    },
    {
      "@type": "Question",
      "name": "What health benefits happen when you stop drinking?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Within 24 hours, blood sugar normalizes. After 1 week, sleep improves. At 1 month, liver fat reduces by 15%. After 3 months, blood pressure may decrease. At 1 year, liver function significantly improves."
      }
    }
  ]
}
</script>
{% endblock %}

{% block extra_css %}
<style>
    /* Page Header - matches site design */
    .calculator-header {
        background: var(--gradient-primary);
        padding: 100px 0 60px;
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
        margin-bottom: 0;
    }
    .calculator-header h1 {
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: white;
    }
    .calculator-header p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        opacity: 0.95;
        color: white;
    }

    /* Calculator Section */
    .calculator-section {
        padding: 3rem 2rem;
        background: linear-gradient(180deg, #f0f7ff 0%, #f8f9fa 100%);
        margin-top: -2rem;
    }
    .calculator-container {
        max-width: 900px;
        margin: 0 auto;
    }
    .calculator-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-hover);
        overflow: hidden;
    }

    /* Input Section */
    .calc-input-section {
        padding: 2.5rem;
        background: var(--gradient-secondary);
        color: white;
        text-align: center;
    }
    .calc-input-section h2 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        font-weight: 600;
        color: white;
    }
    .date-input-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    .date-input-wrapper label {
        font-size: 1.1rem;
        font-weight: 500;
    }
    #sobriety-date {
        padding: 1rem 1.5rem;
        font-size: 1.2rem;
        border: none;
        border-radius: 8px;
        background: white;
        color: var(--primary-dark);
        font-weight: 600;
        cursor: pointer;
        min-width: 200px;
    }
    #sobriety-date:focus {
        outline: 3px solid var(--accent-green);
    }

    /* Results Display */
    .calc-results {
        padding: 3rem 2.5rem;
    }
    .main-counter {
        text-align: center;
        margin-bottom: 2.5rem;
    }
    .days-display {
        font-size: 5rem;
        font-weight: 800;
        color: var(--primary-dark);
        line-height: 1;
        margin-bottom: 0.5rem;
    }
    .days-label {
        font-size: 1.5rem;
        color: var(--accent-green);
        font-weight: 600;
    }

    /* Time Breakdown */
    .time-breakdown {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2.5rem;
    }
    .time-unit {
        background: var(--bg-light);
        padding: 1.5rem 1rem;
        border-radius: 12px;
        text-align: center;
        transition: transform 0.2s ease;
    }
    .time-unit:hover {
        transform: translateY(-2px);
    }
    .time-unit .value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-dark);
        line-height: 1.2;
    }
    .time-unit .label {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.25rem;
    }

    /* Milestones */
    .milestones-container {
        margin-bottom: 2.5rem;
    }
    .milestones-container h3 {
        font-size: 1.2rem;
        color: var(--primary-dark);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .milestones-container h3 i {
        color: var(--accent-green);
    }
    .milestone-track {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }
    .milestone-badge {
        padding: 0.6rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }
    .milestone-badge.achieved {
        background: var(--accent-green);
        color: white;
    }
    .milestone-badge.next {
        background: #fff3cd;
        color: #856404;
        border: 2px dashed #ffc107;
    }
    .milestone-badge.future {
        background: var(--bg-light);
        color: #999;
    }

    /* Money Calculator */
    .money-calculator {
        background: #f0f9ff;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2.5rem;
        border-left: 4px solid var(--primary-light);
    }
    .money-calculator h3 {
        font-size: 1.2rem;
        color: var(--primary-dark);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .money-calculator h3 i {
        color: var(--accent-green);
    }
    .money-input-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }
    .money-input-row label {
        color: #555;
        font-weight: 500;
    }
    .money-input-row input {
        padding: 0.75rem 1rem;
        border: 2px solid #b7d4f8;
        border-radius: 8px;
        font-size: 1.1rem;
        width: 100px;
        font-weight: 600;
    }
    .money-input-row input:focus {
        outline: none;
        border-color: var(--primary-dark);
    }
    .money-saved-display {
        text-align: center;
        padding: 1.5rem;
        background: white;
        border-radius: 10px;
    }
    .money-saved-display .amount {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--accent-green);
    }
    .money-saved-display .label {
        color: #666;
        font-size: 0.95rem;
    }

    /* Health Benefits Timeline */
    .health-benefits {
        margin-bottom: 2.5rem;
    }
    .health-benefits h3 {
        font-size: 1.2rem;
        color: var(--primary-dark);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .health-benefits h3 i {
        color: #e74c3c;
    }
    .benefits-timeline {
        display: grid;
        gap: 0.75rem;
    }
    .benefit-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    .benefit-item.unlocked {
        background: #e8f5e9;
    }
    .benefit-item.locked {
        background: var(--bg-light);
        opacity: 0.7;
    }
    .benefit-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 1rem;
    }
    .benefit-item.unlocked .benefit-icon {
        background: var(--accent-green);
        color: white;
    }
    .benefit-item.locked .benefit-icon {
        background: #dee2e6;
        color: #999;
    }
    .benefit-content .time {
        font-weight: 600;
        color: var(--primary-dark);
        font-size: 0.9rem;
    }
    .benefit-item.locked .benefit-content .time {
        color: #999;
    }
    .benefit-content .description {
        color: #555;
        font-size: 0.9rem;
        margin-top: 0.15rem;
    }

    /* CTA Section in Calculator */
    .calc-cta {
        background: var(--gradient-primary);
        padding: 2.5rem;
        text-align: center;
        color: white;
    }
    .calc-cta h3 {
        font-size: 1.4rem;
        margin-bottom: 0.75rem;
        color: white;
    }
    .calc-cta p {
        opacity: 0.9;
        margin-bottom: 1.5rem;
        color: white;
    }
    .calc-cta .cta-button {
        display: inline-block;
        padding: 1rem 2.5rem;
        background: var(--accent-green);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        border: 2px solid rgba(255,255,255,0.3);
    }
    .calc-cta .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        background: #45a675;
        color: white;
    }
    .calc-cta .benefits-list {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
        font-size: 0.9rem;
        opacity: 0.9;
    }
    .calc-cta .benefits-list span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Placeholder State */
    .placeholder-state {
        text-align: center;
        padding: 3rem;
        color: #999;
    }
    .placeholder-state .icon {
        font-size: 3.5rem;
        margin-bottom: 1rem;
        color: var(--primary-light);
    }
    .placeholder-state p {
        font-size: 1.1rem;
    }

    /* Content Section */
    .content-section {
        padding: 4rem 2rem;
        background: white;
    }
    .content-section .container {
        max-width: 800px;
        margin: 0 auto;
    }
    .content-section h2 {
        color: var(--primary-dark);
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    .content-section h3 {
        color: var(--primary-dark);
        font-size: 1.3rem;
        margin: 2rem 0 1rem;
    }
    .content-section p {
        color: #555;
        line-height: 1.8;
        font-size: 1.05rem;
        margin-bottom: 1rem;
    }
    .content-section ul {
        margin: 1.5rem 0;
        padding-left: 1.5rem;
    }
    .content-section ul li {
        color: #555;
        line-height: 1.8;
        margin-bottom: 0.5rem;
    }

    /* FAQ Section */
    .faq-section {
        padding: 4rem 2rem;
        background: var(--bg-light);
    }
    .faq-section h2 {
        text-align: center;
        color: var(--primary-dark);
        font-size: 2rem;
        margin-bottom: 2rem;
    }
    .faq-container {
        max-width: 800px;
        margin: 0 auto;
    }
    .faq-item {
        background: white;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .faq-item h3 {
        color: var(--primary-dark);
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
    }
    .faq-item p {
        color: #666;
        line-height: 1.7;
        margin: 0;
    }

    /* Related Links */
    .related-section {
        padding: 3rem 2rem;
        background: white;
    }
    .related-section h3 {
        text-align: center;
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
    }
    .related-grid {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
        max-width: 800px;
        margin: 0 auto;
    }
    .related-grid a {
        background: var(--bg-light);
        padding: 0.75rem 1.25rem;
        border-radius: 8px;
        text-decoration: none;
        color: var(--primary-dark);
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .related-grid a:hover {
        background: var(--primary-dark);
        color: white;
        transform: translateY(-2px);
    }

    /* Final CTA */
    .final-cta {
        padding: 5rem 2rem;
        background: var(--gradient-primary);
        text-align: center;
        color: white;
    }
    .final-cta h2 {
        font-size: 2.2rem;
        margin-bottom: 1rem;
        color: white;
    }
    .final-cta p {
        font-size: 1.15rem;
        margin-bottom: 2rem;
        opacity: 0.95;
        color: white;
    }
    .final-cta .cta-button {
        display: inline-block;
        padding: 1rem 2.5rem;
        background: var(--accent-green);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.2rem;
        transition: all 0.3s ease;
        border: 2px solid rgba(255,255,255,0.3);
    }
    .final-cta .cta-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .final-cta .subtext {
        margin-top: 1rem;
        font-size: 0.95rem;
        opacity: 0.85;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .calculator-header h1 { font-size: 2rem; }
        .days-display { font-size: 3.5rem; }
        .days-label { font-size: 1.2rem; }
        .time-breakdown { grid-template-columns: repeat(2, 1fr); }
        .time-unit .value { font-size: 1.6rem; }
        .money-saved-display .amount { font-size: 2rem; }
        .calc-cta .benefits-list { flex-direction: column; gap: 0.5rem; }
        .final-cta h2 { font-size: 1.8rem; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="calculator-header">
    <div class="container">
        <h1>Free Sobriety Calculator</h1>
        <p>Calculate how long you've been sober instantly. See milestones, money saved, and health benefits.</p>
    </div>
</section>

<!-- Calculator Section -->
<section class="calculator-section">
    <div class="calculator-container">
        <div class="calculator-card">
            <!-- Input Section -->
            <div class="calc-input-section">
                <h2>Enter Your Sobriety Date</h2>
                <div class="date-input-wrapper">
                    <label for="sobriety-date">I quit on:</label>
                    <input type="date" id="sobriety-date" max="" aria-label="Select your sobriety start date" />
                </div>
            </div>

            <!-- Results Section -->
            <div class="calc-results">
                <!-- Placeholder State -->
                <div id="placeholder-state" class="placeholder-state">
                    <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                    <p>Select your sobriety date above to see your progress</p>
                </div>

                <!-- Results (hidden by default) -->
                <div id="results-display" style="display: none;">
                    <!-- Main Counter -->
                    <div class="main-counter">
                        <div class="days-display" id="total-days">0</div>
                        <div class="days-label">Days Sober</div>
                    </div>

                    <!-- Time Breakdown -->
                    <div class="time-breakdown">
                        <div class="time-unit">
                            <div class="value" id="years">0</div>
                            <div class="label">Years</div>
                        </div>
                        <div class="time-unit">
                            <div class="value" id="months">0</div>
                            <div class="label">Months</div>
                        </div>
                        <div class="time-unit">
                            <div class="value" id="weeks">0</div>
                            <div class="label">Weeks</div>
                        </div>
                        <div class="time-unit">
                            <div class="value" id="hours">0</div>
                            <div class="label">Hours</div>
                        </div>
                    </div>

                    <!-- Milestones -->
                    <div class="milestones-container">
                        <h3><i class="fas fa-medal"></i> Milestones</h3>
                        <div class="milestone-track" id="milestones-track"></div>
                    </div>

                    <!-- Money Saved Calculator -->
                    <div class="money-calculator">
                        <h3><i class="fas fa-piggy-bank"></i> Money Saved</h3>
                        <div class="money-input-row">
                            <label for="daily-spend">I used to spend about $</label>
                            <input type="number" id="daily-spend" value="15" min="0" step="1" aria-label="Daily spending amount" />
                            <label>per day</label>
                        </div>
                        <div class="money-saved-display">
                            <div class="amount" id="money-saved">$0</div>
                            <div class="label">Total Saved Since Quitting</div>
                        </div>
                    </div>

                    <!-- Health Benefits -->
                    <div class="health-benefits">
                        <h3><i class="fas fa-heart"></i> Health Benefits Unlocked</h3>
                        <div class="benefits-timeline" id="benefits-timeline"></div>
                    </div>
                </div>
            </div>

            <!-- CTA Section -->
            <div class="calc-cta">
                <h3>Save Your Progress</h3>
                <p>Create a free account to track milestones, get reminders, and connect with others in recovery.</p>
                <a href="{% url 'accounts:register' %}" class="cta-button">Save My Sobriety Date</a>
                <div class="benefits-list">
                    <span><i class="fas fa-check"></i> Free to Join</span>
                    <span><i class="fas fa-check"></i> Milestone Alerts</span>
                    <span><i class="fas fa-check"></i> Community Support</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Content Section -->
<section class="content-section">
    <div class="container">
        <h2>How to Use This Sobriety Calculator</h2>
        <p>Our free sobriety calculator helps you track exactly how long you've been sober. Simply enter the date you stopped drinking or using drugs, and the calculator instantly shows your clean time.</p>

        <h3>What Is a Sobriety Date?</h3>
        <p>Your sobriety date is the day you stopped using alcohol or drugs. For most people, this is the day after their last drink or use. For example, if you had your last drink on December 31st, your sobriety date would be January 1st.</p>

        <h3>Why Tracking Sobriety Time Matters</h3>
        <p>Research shows that tracking progress increases motivation and success rates in recovery:</p>
        <ul>
            <li><strong>Builds momentum:</strong> Each day adds to your streak, making you less likely to break it</li>
            <li><strong>Celebrates progress:</strong> Milestones give you concrete achievements to celebrate</li>
            <li><strong>Provides perspective:</strong> On tough days, seeing how far you've come helps you push through</li>
            <li><strong>Creates accountability:</strong> Having a number to protect motivates you to stay sober</li>
        </ul>

        <h3>Sobriety Milestones Worth Celebrating</h3>
        <ul>
            <li><strong>24 Hours:</strong> The first day is often the hardest</li>
            <li><strong>1 Week:</strong> Physical withdrawal symptoms often start to subside</li>
            <li><strong>30 Days:</strong> A major milestone in any recovery program</li>
            <li><strong>90 Days:</strong> The traditional AA chip milestone</li>
            <li><strong>1 Year:</strong> Your soberversary - a life-changing accomplishment</li>
        </ul>

        <h3>What Happens to Your Body When You Quit</h3>
        <ul>
            <li><strong>After 24 hours:</strong> Blood sugar levels start to normalize</li>
            <li><strong>After 1 week:</strong> Sleep quality improves</li>
            <li><strong>After 1 month:</strong> Liver fat can reduce by up to 15%</li>
            <li><strong>After 3 months:</strong> Skin appearance improves, mental clarity increases</li>
            <li><strong>After 1 year:</strong> Risk of heart disease and stroke significantly reduced</li>
        </ul>
    </div>
</section>

<!-- FAQ Section -->
<section class="faq-section">
    <h2>Frequently Asked Questions</h2>
    <div class="faq-container">
        <div class="faq-item">
            <h3>How do I calculate my sobriety date?</h3>
            <p>Enter the last day you drank alcohol or used drugs into the calculator above. The tool automatically calculates your total sober time in days, weeks, months, and years.</p>
        </div>
        <div class="faq-item">
            <h3>What counts as a sobriety date?</h3>
            <p>Your sobriety date is typically the day after your last drink or drug use. For example, if you had your last drink on January 1st, your sobriety date would be January 2nd.</p>
        </div>
        <div class="faq-item">
            <h3>How much money can I save by not drinking?</h3>
            <p>The average person who drinks regularly spends $50-150 per week on alcohol. Over a year, that's $2,600-$7,800 saved. Enter your personal spending to see your exact savings.</p>
        </div>
        <div class="faq-item">
            <h3>What if I relapse?</h3>
            <p>Many people choose to reset their sobriety date after a relapse. However, some track both their original quit date and current streak. What matters most is that you keep trying.</p>
        </div>
        <div class="faq-item">
            <h3>Is this calculator free?</h3>
            <p>Yes, this sobriety calculator is 100% free with no signup required. Create a free MyRecoveryPal account to save your progress and get milestone reminders.</p>
        </div>
    </div>
</section>

<!-- Related Links -->
<section class="related-section">
    <h3>More Recovery Tools</h3>
    <div class="related-grid">
        <a href="{% url 'core:sobriety_counter_app' %}"><i class="fas fa-stopwatch"></i> Sobriety Counter App</a>
        <a href="{% url 'core:alcohol_recovery_app' %}"><i class="fas fa-wine-glass-alt"></i> Alcohol Recovery</a>
        <a href="{% url 'accounts:community' %}"><i class="fas fa-users"></i> Recovery Community</a>
        <a href="{% url 'accounts:challenges_home' %}"><i class="fas fa-trophy"></i> Recovery Challenges</a>
    </div>
</section>

<!-- Final CTA -->
<section class="final-cta">
    <h2>Every Day Sober Matters</h2>
    <p>Join a growing community tracking their recovery journey</p>
    <a href="{% url 'accounts:register' %}" class="cta-button">Start Your Journey Free</a>
    <p class="subtext">No credit card required</p>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('sobriety-date');
    const placeholderState = document.getElementById('placeholder-state');
    const resultsDisplay = document.getElementById('results-display');
    const dailySpendInput = document.getElementById('daily-spend');

    // Set max date to today
    const today = new Date();
    dateInput.max = today.toISOString().split('T')[0];

    const milestones = [
        { days: 1, label: '1 Day' },
        { days: 7, label: '1 Week' },
        { days: 14, label: '2 Weeks' },
        { days: 30, label: '1 Month' },
        { days: 60, label: '2 Months' },
        { days: 90, label: '90 Days' },
        { days: 180, label: '6 Months' },
        { days: 365, label: '1 Year' },
        { days: 730, label: '2 Years' },
        { days: 1825, label: '5 Years' }
    ];

    const healthBenefits = [
        { days: 1, benefit: '24 Hours', description: 'Blood sugar levels begin to normalize' },
        { days: 3, benefit: '3 Days', description: 'Alcohol completely leaves your bloodstream' },
        { days: 7, benefit: '1 Week', description: 'Sleep quality improves, better hydration' },
        { days: 14, benefit: '2 Weeks', description: 'Stomach lining heals, digestion improves' },
        { days: 30, benefit: '1 Month', description: 'Liver fat reduces up to 15%, blood pressure drops' },
        { days: 90, benefit: '3 Months', description: 'Mental clarity improves, skin looks healthier' },
        { days: 180, benefit: '6 Months', description: 'Cardiovascular health significantly improves' },
        { days: 365, benefit: '1 Year', description: 'Risk of heart disease and stroke reduced' }
    ];

    function calculateSobriety(sobrietyDate) {
        const now = new Date();
        const start = new Date(sobrietyDate);
        const diffTime = now - start;
        const totalDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const totalHours = Math.floor(diffTime / (1000 * 60 * 60));

        return {
            totalDays,
            totalHours,
            years: Math.floor(totalDays / 365),
            months: Math.floor(totalDays / 30),
            weeks: Math.floor(totalDays / 7)
        };
    }

    function updateDisplay(sobrietyDate) {
        const stats = calculateSobriety(sobrietyDate);

        placeholderState.style.display = 'none';
        resultsDisplay.style.display = 'block';

        animateNumber('total-days', stats.totalDays);
        document.getElementById('years').textContent = stats.years;
        document.getElementById('months').textContent = stats.months;
        document.getElementById('weeks').textContent = stats.weeks;
        document.getElementById('hours').textContent = stats.totalHours.toLocaleString();

        updateMilestones(stats.totalDays);
        updateMoneySaved(stats.totalDays);
        updateHealthBenefits(stats.totalDays);
    }

    function animateNumber(elementId, target) {
        const element = document.getElementById(elementId);
        const duration = 800;
        const startTime = performance.now();

        function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easeOut = 1 - Math.pow(1 - progress, 3);
            element.textContent = Math.floor(target * easeOut).toLocaleString();
            if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

    function updateMilestones(totalDays) {
        const track = document.getElementById('milestones-track');
        track.innerHTML = '';
        let nextFound = false;

        milestones.forEach(milestone => {
            const badge = document.createElement('div');
            badge.className = 'milestone-badge';

            if (totalDays >= milestone.days) {
                badge.classList.add('achieved');
                badge.innerHTML = `<i class="fas fa-check-circle"></i> ${milestone.label}`;
            } else if (!nextFound) {
                badge.classList.add('next');
                badge.innerHTML = `<i class="fas fa-hourglass-half"></i> ${milestone.label} (${milestone.days - totalDays} days)`;
                nextFound = true;
            } else {
                badge.classList.add('future');
                badge.innerHTML = `<i class="far fa-circle"></i> ${milestone.label}`;
            }
            track.appendChild(badge);
        });
    }

    function updateMoneySaved(totalDays) {
        const dailySpend = parseFloat(dailySpendInput.value) || 0;
        document.getElementById('money-saved').textContent = '$' + (totalDays * dailySpend).toLocaleString();
    }

    function updateHealthBenefits(totalDays) {
        const timeline = document.getElementById('benefits-timeline');
        timeline.innerHTML = '';

        healthBenefits.forEach(benefit => {
            const item = document.createElement('div');
            item.className = 'benefit-item ' + (totalDays >= benefit.days ? 'unlocked' : 'locked');
            item.innerHTML = `
                <div class="benefit-icon">
                    <i class="fas ${totalDays >= benefit.days ? 'fa-check' : 'fa-clock'}"></i>
                </div>
                <div class="benefit-content">
                    <div class="time">${benefit.benefit}</div>
                    <div class="description">${benefit.description}</div>
                </div>
            `;
            timeline.appendChild(item);
        });
    }

    dateInput.addEventListener('change', function() {
        if (this.value) updateDisplay(this.value);
    });

    dailySpendInput.addEventListener('input', function() {
        if (dateInput.value) {
            const stats = calculateSobriety(dateInput.value);
            updateMoneySaved(stats.totalDays);
        }
    });

    // Check for date in URL params
    const urlParams = new URLSearchParams(window.location.search);
    const dateParam = urlParams.get('date');
    if (dateParam) {
        dateInput.value = dateParam;
        updateDisplay(dateParam);
    }
});
</script>
{% endblock %}
