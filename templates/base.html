_match.url_name == 'profile' %}active{% endif %}">
                    Profile
                </a>
                <a href="{% url 'accounts:edit_profile' %}"
                    class="{% if request.resolver_match.url_name == 'edit_profile' %}active{% endif %}">
                    Settings
                </a>
            </div>
            {% endif %}
        </nav>
    
        <div class="mobile-menu-footer">
            {% if user.is_authenticated %}
            <form method="post" action="{% url 'accounts:logout' %}">
                {% csrf_token %}
                <button type="submit" class="mobile-logout-btn">
                    Logout
                </button>
            </form>
            {% else %}
            <a href="{% url 'accounts:login' %}" class="mobile-logout-btn"
                style="text-align: center; display: block; text-decoration: none;">
                Login / Sign Up
            </a>
            {% endif %}
        </div>
    </div>
    <!-- Mobile Bottom Navigation Bar -->
    {% if user.is_authenticated %}
    <nav class="mobile-bottom-nav" id="mobileBottomNav">
        <a href="{% url 'core:index' %}" class="{% if request.resolver_match.url_name == 'index' %}active{% endif %}">
            <span>Home</span>
        </a>
        <a href="{% url 'journal:entry_list' %}"
            class="{% if 'journal' in request.resolver_match.namespace %}active{% endif %}">
            <span>Journal</span>
        </a>
        <a href="{% url 'resources:list' %}"
            class="{% if 'resources' in request.resolver_match.namespace %}active{% endif %}">
            <span>Resources</span>
        </a>
        <a href="{% url 'accounts:community' %}"
            class="{% if request.resolver_match.url_name == 'community' %}active{% endif %}">
            <span>Community</span>
        </a>
        <a href="{% url 'accounts:dashboard' %}"
            class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
            <span>Account</span>
        </a>
    </nav>
    {% else %}
    <nav class="mobile-bottom-nav" id="mobileBottomNav">
        <a href="{% url 'core:index' %}" class="{% if request.resolver_match.url_name == 'index' %}active{% endif %}">
            <span>Home</span>
        </a>
        <a href="{% url 'blog:post_list' %}"
            class="{% if 'blog' in request.resolver_match.namespace %}active{% endif %}">
            <span>Blog</span>
        </a>
        <a href="{% url 'resources:list' %}"
            class="{% if 'resources' in request.resolver_match.namespace %}active{% endif %}">
            <span>Resources</span>
        </a>
        <a href="{% url 'store:product_list' %}"
            class="{% if 'store' in request.resolver_match.namespace %}active{% endif %}">
            <span>Store</span>
        </a>
        <a href="{% url 'accounts:login' %}">
            Login
        </a>
    </nav>
    {% endif %}

    <!-- Messages/Alerts -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content -->
    <main id="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About</h3>
                <ul>
                    <li><a href="{% url 'core:about' %}">Our Mission</a></li>
                    <li><a href="{% url 'core:team' %}">Team</a></li>
                    <li><a href="{% url 'core:contact' %}">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul>
                    <li><a href="{% url 'resources:list' %}">Recovery Tools</a></li>
                    <li><a href="{% url 'blog:post_list' %}">Blog</a></li>
                    <li><a href="#">Crisis Support</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Community</h3>
                <ul>
                    <li><a href="{% url 'accounts:community' %}">Members</a></li>
                    <li><a href="{% url 'core:guidelines' %}">Guidelines</a></li>
                    <li><a href="{% url 'core:success_stories' %}">Success Stories</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <ul>
                    <li><a href="{% url 'core:privacy' %}">Privacy Policy</a></li>
                    <li><a href="{% url 'core:terms' %}">Terms of Service</a></li>
                    <li><a href="{% url 'core:cookies' %}">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 MyRecoveryPal. All rights reserved. | Recovery is possible.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // Mobile detection
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) {
            document.body.classList.add('is-mobile');
        }

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installBanner = document.getElementById('installBanner');
            if (installBanner) {
                installBanner.classList.add('show');
            }
        });

        const installBtn = document.getElementById('installBtn');
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                const installBanner = document.getElementById('installBanner');
                installBanner.classList.remove('show');
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to install prompt: ${outcome}`);
                    deferredPrompt = null;
                }
            });
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('{% static "service-worker.js" %}')
                    .then(registration => console.log('ServiceWorker registered'))
                    .catch(err => console.log('ServiceWorker registration failed: ', err));
            });
        }

        // Offline detection
        window.addEventListener('online', () => {
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', () => {
            document.body.classList.add('offline');
        });

        // Toggle user dropdown menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileSlideMenu');
            const overlay = document.getElementById('mobileNavOverlay');
            const hamburger = document.getElementById('hamburgerBtn');
            const body = document.body;

            menu.classList.toggle('active');
            overlay.classList.toggle('active');
            hamburger.classList.toggle('active');
            body.classList.toggle('menu-open');
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileSlideMenu');
            const overlay = document.getElementById('mobileNavOverlay');
            const hamburger = document.getElementById('hamburgerBtn');
            const body = document.body;

            menu.classList.remove('active');
            overlay.classList.remove('active');
            hamburger.classList.remove('active');
            body.classList.remove('menu-open');
        }

        // Close menu when clicking on a link
        document.querySelectorAll('.mobile-menu-nav a').forEach(link => {
            link.addEventListener('click', () => {
                closeMobileMenu();
            });
        });

        // Close menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function (event) {
            const userMenu = document.querySelector('.user-menu');
            const userDropdown = document.getElementById('userDropdown');

            if (userMenu && !userMenu.contains(event.target)) {
                userDropdown.classList.remove('active');
            }
        });

        // Add scroll effect to navigation
        window.addEventListener('scroll', function () {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.style.boxShadow = '0 2px 20px rgba(0,0,0,0.1)';
            } else {
                nav.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
            }
        });

        // Touch gesture support
        let touchStartX = 0;
        let touchEndX = 0;

        function handleGesture() {
            if (touchEndX < touchStartX - 50) {
                // Swiped left - could be used for navigation
                console.log('Swiped left');
            }
            if (touchEndX > touchStartX + 50) {
                // Swiped right - could be used for navigation
                console.log('Swiped right');
            }
        }

        // Add touch listeners to swipeable elements
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleGesture();
        });
    </script>

    <!-- Notification System Script -->
    <script>
        // Notification System
        let notificationCheckInterval;
        const isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};

        // Initialize notifications on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (isAuthenticated) {
                checkNotifications();
                // Check for new notifications every 30 seconds
                notificationCheckInterval = setInterval(checkNotifications, 30000);
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', function(event) {
                    const notifDropdown = document.getElementById('notificationDropdown');
                    const notifIndicator = document.getElementById('notificationIndicator');
                    const userMenu = document.querySelector('.user-menu');
                    
                    if (notifDropdown && !notifDropdown.contains(event.target) && 
                        !notifIndicator.contains(event.target)) {
                        notifDropdown.classList.remove('active');
                    }
                });
            }
        });

        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            const userDropdown = document.getElementById('userDropdown');
            
            // Close user dropdown if open
            if (userDropdown) {
                userDropdown.classList.remove('active');
            }
            
            dropdown.classList.toggle('active');
            
            if (dropdown.classList.contains('active')) {
                loadNotifications();
            }
        }

        async function checkNotifications() {
            try {
                const response = await fetch('{% url "accounts:unread_count_api" %}', {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                const data = await response.json();
                updateNotificationIndicator(data.count);
            } catch (error) {
                console.error('Error checking notifications:', error);
            }
        }

        function updateNotificationIndicator(count) {
            const dot = document.getElementById('notificationDot');
            if (count > 0) {
                dot.classList.add('has-notifications');
                // Optional: Add tooltip with count
                dot.parentElement.title = `${count} new notification${count > 1 ? 's' : ''}`;
            } else {
                dot.classList.remove('has-notifications');
                dot.parentElement.title = 'No new notifications';
            }
        }

        async function loadNotifications() {
            try {
                const response = await fetch('{% url "accounts:notifications_api" %}', {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                const data = await response.json();
                renderNotifications(data.notifications);
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function renderNotifications(notifications) {
            const listElement = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                listElement.innerHTML = `
                    <div class="empty-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <p>No notifications</p>
                    </div>
                `;
                return;
            }
            
            listElement.innerHTML = notifications.map(notification => `
                <a href="${notification.link || '#'}" class="notification-item ${notification.is_read ? '' : 'unread'}" 
                   onclick="handleNotificationClick(event, ${notification.id}, '${notification.link || ''}')">
                    <div class="notification-avatar">
                        ${notification.sender_avatar ? 
                            `<img src="${notification.sender_avatar}" alt="${notification.sender_name}">` :
                            `<i class="fas ${notification.icon}"></i>`
                        }
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${notification.time_ago}</div>
                    </div>
                </a>
            `).join('');
        }

        async function handleNotificationClick(event, notificationId, link) {
            // If notification has no link, prevent default
            if (!link || link === '#') {
                event.preventDefault();
            }
            
            // Mark as read
            await markNotificationAsRead(notificationId);
            
            // If there's a link and we prevented default, navigate manually
            if (link && link !== '#' && event.defaultPrevented) {
                window.location.href = link;
            }
        }

        async function markNotificationAsRead(notificationId) {
            try {
                const response = await fetch(`/accounts/api/notifications/${notificationId}/read/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (response.ok) {
                    // Refresh notification count
                    checkNotifications();
                }
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        async function markAllAsRead(event) {
            event.preventDefault();
            
            try {
                const response = await fetch('{% url "accounts:mark_all_notifications_read" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (response.ok) {
                    loadNotifications();
                    checkNotifications();
                }
            } catch (error) {
                console.error('Error marking all as read:', error);
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

    <!-- Additional Scripts -->
    {% block extra_js %}{% endblock %}
</body>

</html>