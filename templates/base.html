<!-- Add this updated CSS to replace the existing mobile navigation styles in your base.html -->

<style>
/* ========================================
   MOBILE SLIDE-OUT NAVIGATION
   ======================================== */
   
/* Mobile Navigation Overlay */
.mobile-nav-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 998;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mobile-nav-overlay.active {
    display: block;
    opacity: 1;
}

/* Mobile Slide-Out Menu */
.mobile-slide-menu {
    position: fixed;
    top: 0;
    right: -280px;
    width: 280px;
    height: 100%;
    background: white;
    z-index: 999;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    box-shadow: -2px 0 20px rgba(0, 0, 0, 0.1);
}

.mobile-slide-menu.active {
    transform: translateX(-280px);
}

/* Mobile Menu Header */
.mobile-menu-header {
    background: var(--gradient-primary);
    padding: 1.5rem;
    color: white;
    position: relative;
}

.mobile-menu-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s ease;
}

.mobile-menu-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

.mobile-menu-close svg {
    width: 20px;
    height: 20px;
    stroke: white;
    stroke-width: 2;
}

.mobile-menu-user {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
}

.mobile-menu-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-dark);
    font-weight: bold;
    font-size: 1.2rem;
}

.mobile-menu-user-info h3 {
    margin: 0;
    font-size: 1.1rem;
    color: white;
}

.mobile-menu-user-info p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.9;
    color: white;
}

/* Mobile Menu Navigation */
.mobile-menu-nav {
    padding: 1rem 0;
}

.mobile-menu-section {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e5e7eb;
}

.mobile-menu-section:last-child {
    border-bottom: none;
}

.mobile-menu-label {
    padding: 0.5rem 1.5rem;
    font-size: 0.75rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
}

.mobile-menu-nav a {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1.5rem;
    color: var(--text-dark);
    text-decoration: none;
    transition: background 0.2s ease;
    position: relative;
}

.mobile-menu-nav a:active {
    background: var(--bg-light);
}

.mobile-menu-nav a.active {
    background: #f0f9ff;
    color: var(--primary-dark);
}

.mobile-menu-nav a.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--accent-green);
}

.mobile-menu-nav i {
    width: 20px;
    text-align: center;
    color: var(--primary-light);
}

.mobile-menu-nav .badge {
    margin-left: auto;
    background: #ff4444;
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    font-size: 0.75rem;
}

/* Mobile Menu Footer */
.mobile-menu-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e5e7eb;
    margin-top: auto;
}

.mobile-logout-btn {
    width: 100%;
    padding: 0.75rem;
    background: var(--accent-green);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
}

.mobile-logout-btn:active {
    background: #45a675;
}

/* Hamburger Menu Animation */
.hamburger {
    display: none;
    width: 48px;
    height: 48px;
    padding: 12px;
    cursor: pointer;
    background: transparent;
    border: none;
    position: relative;
}

.hamburger-line {
    display: block;
    width: 24px;
    height: 2px;
    background: var(--primary-dark);
    margin: 5px 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.hamburger.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
}

.hamburger.active .hamburger-line:nth-child(2) {
    opacity: 0;
    transform: translateX(-10px);
}

.hamburger.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

/* Mobile-specific styles */
@media (max-width: 768px) {
    .hamburger {
        display: block;
    }
    
    /* Hide desktop nav links on mobile */
    .nav-links {
        display: none !important;
    }
    
    /* Prevent body scroll when menu is open */
    body.menu-open {
        overflow: hidden;
    }
}

/* Touch feedback */
@media (hover: none) and (pointer: coarse) {
    .mobile-menu-nav a:active {
        background: #f3f4f6;
        transform: scale(0.98);
    }
    
    .mobile-menu-close:active {
        transform: scale(0.95);
    }
}
</style>

<!-- Replace the existing mobile menu button in your nav with this -->
<button class="hamburger" id="hamburgerBtn" onclick="toggleMobileMenu()" aria-label="Menu">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
</button>

<!-- Add this right after the closing </nav> tag -->
<div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileMenu()"></div>

<div class="mobile-slide-menu" id="mobileSlideMenu">
    <div class="mobile-menu-header">
        <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="Close menu">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
        {% if user.is_authenticated %}
        <div class="mobile-menu-user">
            <div class="mobile-menu-avatar">
                {% if user.profile_picture %}
                <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" 
                     style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                {% else %}
                {{ user.username|first|upper }}
                {% endif %}
            </div>
            <div class="mobile-menu-user-info">
                <h3>{{ user.username }}</h3>
                <p>{{ user.email }}</p>
            </div>
        </div>
        {% else %}
        <div class="mobile-menu-user">
            <div class="mobile-menu-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="mobile-menu-user-info">
                <h3>Welcome</h3>
                <p>Sign in to continue</p>
            </div>
        </div>
        {% endif %}
    </div>
    
    <nav class="mobile-menu-nav">
        <div class="mobile-menu-section">
            <div class="mobile-menu-label">Main</div>
            <a href="{% url 'core:index' %}" class="{% if request.resolver_match.url_name == 'index' %}active{% endif %}">
                <i class="fas fa-home"></i>
                Home
            </a>
            <a href="{% url 'blog:post_list' %}" class="{% if 'blog' in request.resolver_match.namespace %}active{% endif %}">
                <i class="fas fa-newspaper"></i>
                Blog
            </a>
            <a href="{% url 'resources:list' %}" class="{% if 'resources' in request.resolver_match.namespace %}active{% endif %}">
                <i class="fas fa-book-open"></i>
                Resources
            </a>
            <a href="{% url 'store:product_list' %}" class="{% if 'store' in request.resolver_match.namespace %}active{% endif %}">
                <i class="fas fa-shopping-cart"></i>
                Store
            </a>
        </div>
        
        {% if user.is_authenticated %}
        <div class="mobile-menu-section">
            <div class="mobile-menu-label">Recovery Tools</div>
            <a href="{% url 'journal:entry_list' %}" class="{% if 'journal' in request.resolver_match.namespace %}active{% endif %}">
                <i class="fas fa-book"></i>
                Journal
            </a>
            <a href="{% url 'accounts:milestones' %}" class="{% if request.resolver_match.url_name == 'milestones' %}active{% endif %}">
                <i class="fas fa-trophy"></i>
                Milestones
            </a>
            <a href="{% url 'accounts:challenges_home' %}" class="{% if 'challenge' in request.resolver_match.url_name %}active{% endif %}">
                <i class="fas fa-flag-checkered"></i>
                Challenges
                {% if user_active_challenges_count > 0 %}
                <span class="badge">{{ user_active_challenges_count }}</span>
                {% endif %}
            </a>
        </div>
        
        <div class="mobile-menu-section">
            <div class="mobile-menu-label">Community</div>
            <a href="{% url 'accounts:community' %}" class="{% if request.resolver_match.url_name == 'community' %}active{% endif %}">
                <i class="fas fa-users"></i>
                Members
            </a>
            <a href="{% url 'accounts:groups_list' %}" class="{% if 'group' in request.resolver_match.url_name %}active{% endif %}">
                <i class="fas fa-user-friends"></i>
                Groups
            </a>
            <a href="{% url 'accounts:messages' %}" class="{% if request.resolver_match.url_name == 'messages' %}active{% endif %}">
                <i class="fas fa-envelope"></i>
                Messages
                {% if user.received_messages.filter.is_read.count > 0 %}
                <span class="badge">{{ user.received_messages.filter.is_read.count }}</span>
                {% endif %}
            </a>
        </div>
        
        <div class="mobile-menu-section">
            <div class="mobile-menu-label">Account</div>
            <a href="{% url 'accounts:dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
            </a>
            <a href="{% url 'accounts:profile' username=user.username %}" class="{% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                <i class="fas fa-user-circle"></i>
                Profile
            </a>
            <a href="{% url 'accounts:edit_profile' %}" class="{% if request.resolver_match.url_name == 'edit_profile' %}active{% endif %}">
                <i class="fas fa-cog"></i>
                Settings
            </a>
        </div>
        {% endif %}
    </nav>
    
    <div class="mobile-menu-footer">
        {% if user.is_authenticated %}
        <form method="post" action="{% url 'accounts:logout' %}">
            {% csrf_token %}
            <button type="submit" class="mobile-logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </form>
        {% else %}
        <a href="{% url 'accounts:login' %}" class="mobile-logout-btn" style="text-align: center; display: block; text-decoration: none;">
            <i class="fas fa-sign-in-alt"></i> Login / Sign Up
        </a>
        {% endif %}
    </div>
</div>

<!-- Updated JavaScript -->
<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobileSlideMenu');
    const overlay = document.getElementById('mobileNavOverlay');
    const hamburger = document.getElementById('hamburgerBtn');
    const body = document.body;
    
    menu.classList.toggle('active');
    overlay.classList.toggle('active');
    hamburger.classList.toggle('active');
    body.classList.toggle('menu-open');
}

function closeMobileMenu() {
    const menu = document.getElementById('mobileSlideMenu');
    const overlay = document.getElementById('mobileNavOverlay');
    const hamburger = document.getElementById('hamburgerBtn');
    const body = document.body;
    
    menu.classList.remove('active');
    overlay.classList.remove('active');
    hamburger.classList.remove('active');
    body.classList.remove('menu-open');
}

// Close menu when clicking on a link
document.querySelectorAll('.mobile-menu-nav a').forEach(link => {
    link.addEventListener('click', () => {
        closeMobileMenu();
    });
});

// Close menu on escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeMobileMenu();
    }
});

// Prevent scroll when menu is open
let scrollPosition = 0;

function disableScroll() {
    scrollPosition = window.pageYOffset;
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollPosition}px`;
    document.body.style.width = '100%';
}

function enableScroll() {
    document.body.style.removeProperty('overflow');
    document.body.style.removeProperty('position');
    document.body.style.removeProperty('top');
    document.body.style.removeProperty('width');
    window.scrollTo(0, scrollPosition);
}
</script>