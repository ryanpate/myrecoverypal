# MyRecoveryPal Mobile App Guide

## Overview

MyRecoveryPal is now configured to be deployed as native mobile apps for both iOS (App Store) and Android (Google Play) using Capacitor. This guide covers everything you need to build, test, and deploy the apps.

## Architecture

The mobile apps use a **hybrid approach**:
- The apps are native iOS and Android applications
- They load the production website (https://www.myrecoverypal.com) within a native WebView
- Native features like push notifications are integrated
- Works offline thanks to the existing PWA service worker
- Provides a true app experience with native UI elements

## Prerequisites

### For Android Development

1. **Java Development Kit (JDK)** - Version 17 or higher
   ```bash
   # Check if installed
   java -version

   # Install on Ubuntu/Debian
   sudo apt-get install openjdk-17-jdk

   # Install on macOS
   brew install openjdk@17
   ```

2. **Android Studio** - Latest stable version
   - Download from: https://developer.android.com/studio
   - During installation, make sure to install:
     - Android SDK
     - Android SDK Platform
     - Android Virtual Device (for testing)

3. **Environment Variables**
   ```bash
   # Add to ~/.bashrc or ~/.zshrc
   export ANDROID_HOME=$HOME/Android/Sdk
   export PATH=$PATH:$ANDROID_HOME/tools
   export PATH=$PATH:$ANDROID_HOME/platform-tools
   ```

### For iOS Development

1. **macOS** - iOS apps can only be built on macOS
2. **Xcode** - Latest stable version from Mac App Store
3. **CocoaPods**
   ```bash
   sudo gem install cocoapods
   ```
4. **Apple Developer Account** - Required for App Store submission
   - Individual: $99/year
   - Organization: $99/year
   - Sign up at: https://developer.apple.com

### For Both Platforms

1. **Node.js** - Version 18 or higher (already installed)
2. **npm** - Comes with Node.js (already installed)
3. **Capacitor** - Already installed in this project

## Project Structure

```
myrecoverypal/
├── android/                 # Android native project
│   ├── app/
│   │   └── src/main/
│   │       ├── AndroidManifest.xml
│   │       └── res/         # App icons and resources
│   └── build.gradle
├── ios/                     # iOS native project
│   ├── App/
│   │   ├── App/
│   │   │   ├── Info.plist
│   │   │   └── Assets.xcassets/  # App icons and resources
│   │   └── App.xcodeproj
│   └── Podfile
├── www/                     # Web assets for Capacitor
│   └── index.html           # Splash screen / loading page
├── capacitor.config.json    # Capacitor configuration
├── package.json             # Node.js dependencies
└── setup-app-icons.sh       # Icon generation script
```

## Initial Setup (Already Completed)

The following steps have already been completed for this project:

1. ✅ Installed Capacitor: `@capacitor/core`, `@capacitor/cli`, `@capacitor/ios`, `@capacitor/android`
2. ✅ Installed push notifications plugin: `@capacitor/push-notifications`
3. ✅ Initialized Capacitor project with app ID: `com.myrecoverypal.app`
4. ✅ Added Android platform
5. ✅ Added iOS platform
6. ✅ Configured server URL to point to production website
7. ✅ Set up basic splash screen configuration

## Building the Apps

### Step 1: Update Web Assets

Whenever you make changes to the web app, sync them to the native projects:

```bash
# Sync web assets and plugins to native projects
npx cap sync

# Or sync to a specific platform
npx cap sync android
npx cap sync ios
```

### Step 2: Generate App Icons

Before building, you should set up proper app icons:

```bash
# Option 1: Use the provided script (requires ImageMagick)
./setup-app-icons.sh

# Option 2: Use online tools
# - Android: Use Android Studio's Image Asset Studio
# - iOS: Use https://appicon.co/ or Xcode's asset catalog
```

**Icon Specifications:**

**Android:**
- 512x512 PNG for Play Store
- Multiple densities (mdpi through xxxhdpi) generated by script

**iOS:**
- 1024x1024 PNG for App Store
- Various sizes in Assets.xcassets (generated by tools)

### Step 3: Build for Android

```bash
# Open Android Studio
npx cap open android

# Or build from command line
cd android
./gradlew assembleDebug          # Debug build
./gradlew assembleRelease        # Release build (requires signing)
```

**Signing the Android App:**

1. Create a keystore:
   ```bash
   keytool -genkey -v -keystore myrecoverypal.keystore \
     -alias myrecoverypal -keyalg RSA -keysize 2048 -validity 10000
   ```

2. Create `android/key.properties`:
   ```properties
   storePassword=YOUR_KEYSTORE_PASSWORD
   keyPassword=YOUR_KEY_PASSWORD
   keyAlias=myrecoverypal
   storeFile=../myrecoverypal.keystore
   ```

3. Update `android/app/build.gradle` to use the signing configuration

4. Build signed APK/AAB:
   ```bash
   cd android
   ./gradlew bundleRelease   # For Play Store (AAB)
   ./gradlew assembleRelease # For direct distribution (APK)
   ```

### Step 4: Build for iOS

```bash
# Open Xcode
npx cap open ios
```

**In Xcode:**

1. Select your development team in Signing & Capabilities
2. Update the Bundle Identifier if needed
3. Select a target device or simulator
4. Click the Play button to build and run

**For App Store submission:**

1. Update version number in `ios/App/App.xcodeproj`
2. Archive the app: Product → Archive
3. Validate and upload through Xcode Organizer

## Testing

### Testing on Android

**Emulator:**
```bash
# Open Android Studio
npx cap open android
# Use AVD Manager to create and run emulator
```

**Physical Device:**
1. Enable Developer Options on Android device
2. Enable USB Debugging
3. Connect via USB
4. Device will appear in Android Studio

**Run the app:**
```bash
npx cap run android
```

### Testing on iOS

**Simulator:**
```bash
npx cap open ios
# Select simulator in Xcode and click Play
```

**Physical Device:**
1. Connect iPhone/iPad via USB
2. Trust the computer on device
3. Select device in Xcode
4. Click Play

## Push Notifications Setup

### Android (Firebase Cloud Messaging)

1. **Create Firebase Project**
   - Go to https://console.firebase.google.com
   - Create new project or use existing
   - Add Android app with package name: `com.myrecoverypal.app`

2. **Download Configuration**
   - Download `google-services.json`
   - Place in `android/app/` directory

3. **Update AndroidManifest.xml**
   ```xml
   <uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
   ```

4. **Update Django Backend**
   - Install: `pip install firebase-admin`
   - Send notifications using FCM server key

### iOS (Apple Push Notification Service)

1. **Create App ID**
   - Go to Apple Developer Portal
   - Create App ID with Push Notifications capability

2. **Create APNs Certificate**
   - Generate APNs SSL certificate
   - Download and add to Keychain

3. **Update Capabilities in Xcode**
   - Enable Push Notifications
   - Enable Background Modes → Remote notifications

4. **Update Django Backend**
   - Use APNs certificates to send push notifications
   - Libraries: `apns2` or `django-push-notifications`

## App Store Submission

### Google Play Store (Android)

1. **Create Developer Account**
   - Cost: $25 one-time fee
   - Sign up at: https://play.google.com/console

2. **Prepare Store Listing**
   - App name: MyRecoveryPal
   - Short description (80 chars)
   - Full description (4000 chars)
   - Screenshots (min 2, max 8):
     - Phone: 1080x1920 or 1080x2340
     - Tablet: 1200x1920 or 1600x2560
   - Feature graphic: 1024x500
   - App icon: 512x512

3. **Upload AAB**
   ```bash
   cd android
   ./gradlew bundleRelease
   # Upload android/app/build/outputs/bundle/release/app-release.aab
   ```

4. **Set Up App Content**
   - Content rating questionnaire
   - Target audience
   - Privacy policy: https://www.myrecoverypal.com/privacy/
   - App category: Health & Fitness

5. **Submit for Review**
   - Initial review: 1-7 days
   - Updates: Usually 1-3 days

### Apple App Store (iOS)

1. **Create App in App Store Connect**
   - Go to https://appstoreconnect.apple.com
   - Create new app
   - Bundle ID: com.myrecoverypal.app

2. **Prepare Store Listing**
   - App name: MyRecoveryPal
   - Subtitle (30 chars)
   - Description (4000 chars)
   - Keywords (100 chars)
   - Screenshots:
     - iPhone: Various sizes for different models
     - iPad: Various sizes if supporting iPad
   - App icon: 1024x1024
   - App preview videos (optional but recommended)

3. **Upload Build**
   - Archive in Xcode
   - Upload through Xcode Organizer
   - Wait for processing (10-30 minutes)

4. **Set Up App Information**
   - Category: Health & Fitness
   - Content rights
   - Age rating
   - Privacy policy: https://www.myrecoverypal.com/privacy/

5. **Submit for Review**
   - Initial review: 1-3 days (Apple)
   - Updates: Usually 1-2 days

## Updating the Apps

When you update the web app:

1. **For hybrid approach (current setup):**
   - Updates to the website automatically appear in the app
   - Only rebuild and resubmit if changing native features or plugins
   - No app store review needed for web content changes

2. **When to resubmit:**
   - Changing app icons or splash screens
   - Adding new native plugins
   - Updating Capacitor or plugin versions
   - Changing app metadata or permissions

3. **Update process:**
   ```bash
   # Update version in package.json
   npm version patch  # or minor, or major

   # Sync changes
   npx cap sync

   # Update Android version
   # Edit android/app/build.gradle
   # Increment versionCode and versionName

   # Update iOS version
   # In Xcode: General → Version and Build

   # Build and submit new versions
   ```

## Troubleshooting

### Common Android Issues

**Gradle build fails:**
```bash
cd android
./gradlew clean
./gradlew build --stacktrace
```

**USB debugging not working:**
- Check USB cable (use data cable, not charge-only)
- Revoke USB debugging permissions and re-enable
- Try different USB port

**App crashes on startup:**
- Check server URL in capacitor.config.json
- Verify AndroidManifest.xml permissions
- Check logcat for error messages

### Common iOS Issues

**CocoaPods errors:**
```bash
cd ios
pod deintegrate
pod install --repo-update
```

**Signing errors:**
- Verify Apple Developer account is active
- Check Bundle Identifier matches App ID
- Ensure certificates are valid

**App not loading:**
- Check Info.plist for correct permissions
- Verify server URL is accessible
- Check for Content Security Policy issues

### General Issues

**App shows blank screen:**
- Check network connectivity
- Verify server URL: https://www.myrecoverypal.com
- Check browser console in remote debugging

**Push notifications not working:**
- Android: Verify google-services.json is present
- iOS: Check APNs certificates are valid
- Both: Test with device tokens in Django admin

## Configuration Files

### capacitor.config.json

Current configuration connects to production server:

```json
{
  "appId": "com.myrecoverypal.app",
  "appName": "MyRecoveryPal",
  "webDir": "www",
  "server": {
    "url": "https://www.myrecoverypal.com",
    "cleartext": true
  }
}
```

**For development/testing**, you can change the server URL:
```json
"server": {
  "url": "http://192.168.1.100:8000",  // Your local IP
  "cleartext": true
}
```

**For production builds**, always use HTTPS:
```json
"server": {
  "url": "https://www.myrecoverypal.com"
}
```

## Performance Optimization

1. **Leverage existing PWA caching:**
   - Service worker already provides offline support
   - No additional native caching needed

2. **Optimize images:**
   - Use WebP format where possible
   - Lazy load images in Django templates

3. **Minimize API calls:**
   - Use Django's session caching
   - Implement pagination for lists

4. **Native performance:**
   - Minimize DOM manipulation
   - Use native plugins sparingly

## Security Considerations

1. **Content Security Policy:**
   - Already configured in www/index.html
   - Allow only trusted domains

2. **API Security:**
   - Use HTTPS only (already configured)
   - Implement CSRF protection (Django provides this)
   - Use secure session cookies

3. **Data Storage:**
   - Sensitive data in Django backend only
   - Use localStorage sparingly
   - Never store passwords locally

4. **App Signing:**
   - Keep keystores and certificates secure
   - Use different keys for debug/release
   - Backup signing keys securely

## Resources

- **Capacitor Docs:** https://capacitorjs.com/docs
- **Android Developer:** https://developer.android.com
- **Apple Developer:** https://developer.apple.com
- **Firebase Console:** https://console.firebase.google.com
- **App Store Connect:** https://appstoreconnect.apple.com
- **Google Play Console:** https://play.google.com/console

## Support

For issues specific to MyRecoveryPal mobile apps:
- Email: ryan@myrecoverypal.com
- Check this guide first
- Review Capacitor documentation
- Check platform-specific documentation (Android/iOS)

## Next Steps

1. **Set up developer accounts:**
   - [ ] Google Play Developer Account ($25)
   - [ ] Apple Developer Account ($99/year)

2. **Prepare marketing materials:**
   - [ ] App screenshots for all devices
   - [ ] App icon in all required sizes
   - [ ] App description and keywords
   - [ ] Privacy policy URL

3. **Set up analytics:**
   - [ ] Google Analytics for mobile
   - [ ] Firebase Analytics
   - [ ] App Store analytics

4. **Plan release:**
   - [ ] Soft launch in select regions
   - [ ] Beta testing with TestFlight (iOS) / Internal Testing (Android)
   - [ ] Full public release

5. **Marketing:**
   - [ ] Update website to link to app stores
   - [ ] Social media announcements
   - [ ] Email campaign to existing users
   - [ ] App Store Optimization (ASO)

---

**Version:** 1.0.0
**Last Updated:** November 16, 2025
**Maintained By:** MyRecoveryPal Development Team
